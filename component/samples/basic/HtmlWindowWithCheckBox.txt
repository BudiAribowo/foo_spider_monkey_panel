window.DefinePanel('Html window with checkbox', {author: 'TheQwertiest'});

include(fb.ComponentPath + "docs\\Flags.js");

var WshShell = new ActiveXObject('WScript.Shell');

function get_windows_version() {
    var version = '';

    try {
        version = (WshShell.RegRead('HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\CurrentMajorVersionNumber')).toString();
        version += '.';
        version += (WshShell.RegRead('HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\CurrentMinorVersionNumber')).toString();

        return version;
    }
    catch (e) {
    }

    try {
        version = WshShell.RegRead('HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\CurrentVersion');

        return version;
    }
    catch (e) {
    }

    return '6.1';
}

var htmlCode = function() {
    var htmlCode = utils.ReadTextFile( `${fb.ComponentPath}\\samples\\basic\\html\\MsgBoxWithPopup.html`);
    
    var cssPath = `${fb.ComponentPath}\\samples\\basic\\html\\`;
    if ( get_windows_version() === '6.1' ) {
        cssPath += "styles7.css";
    }
    else {
        cssPath += "styles10.css";
    }
    htmlCode = htmlCode.replace(/href="styles10.css"/i, `href="${cssPath}"`);
    return htmlCode;
}();

var htmlWindow;
var ww = 0;
var wh = 0;
var text = '>> Click Me To Open Dialog <<';
var font = gdi.Font('Segoe Ui Semibold', 11);

function on_paint(gr) {
    gr.SetTextRenderingHint(TextRenderingHint.ClearTypeGridFit);
    gr.DrawString(text, font, 0xFF000000, 0, 0, ww, wh, 0x11000000);
}

function on_size(w,h) {
    ww = w;
    wh = h;
}

function on_mouse_lbtn_up() {
    if (htmlWindow) {
        close_window();
    }
    else {
        htmlWindow = utils.CreateHtmlWindow(htmlCode, {
            title: 'Html Window',
            data: ['This is an HTML notification window with a check box\n', '< Click me'],
            fn:   window_ok_callback
        });
        text = '>> Click Me To Close Dialog <<';
        window.Repaint();
    }
}

function on_script_unload() {
    close_window();
}

function close_window()
{
    if (htmlWindow) {
        if (!htmlWindow.IsClosed) {
            htmlWindow.Close();
        }
        htmlWindow = undefined;
        
        text = '>> Click Me To Open Dialog <<';
        window.Repaint();
    }
}

function window_ok_callback(status, clicked) {
    htmlWindow = undefined;
    text = `Dialog was closed with ${status} and checkbox ${clicked}\n`
        + '>> Click Me To Open Dialog <<';
    window.Repaint();
}